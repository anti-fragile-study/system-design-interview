# Ch15. 구글 드라이브 설계

### 한 대의 서버에 업로드된 파일을 전부 저장하다보니 파일 시스템이 가득차게 되었다. 이때 적절한 해결방법을 제시하시오.

* 여러 사용자가 하나의 파일을 동시에 수정할 경우, 동기화 충돌이 발생할 수 있다. 이를 해결할 수 있는 방법을 제시하시오.
* 파일이 매번 갱신될 때마다 전체 파일을 저장소 서버로 전송한다면 네트워크 대역폭을 많이 소모하게 된다. 이를 최적화 할 수 있는 방안을 제시하시오.

<details>
<summary><h4>해설</h4></summary>

> 한 대의 서버에 업로드된 파일을 전부 저장하다보니 파일 시스템이 가득차게 되었다. 이때 적절한 해결방법을 제시하시오.
* 업로드되는 파일 데이터를 샤딩해 여러 서버에 분할 저장할 수 있다. 예를 들어, 사용자 id 값을 모듈러 사딩해 적절한 서버에 데이터를 저장할 수 있다.
* 혹은 데이터 안정성과 가용성을 보장하기 위해, 지역별 다중화를 지원하는 S3와 같은 클라우드 저장소를 사용할 수 있다.

> 여러 사용자가 하나의 파일을 동시에 수정할 경우, 동기화 충돌이 발생할 수 있다. 이를 해결할 수 있는 방법을 제시하시오.
* 먼저 처리된 사용자 요청을 승낙하고, 나중에 처리된 변경은 충돌이 발생한 것으로 처리하는 방식을 도입할 수 있다.
* 충돌이 발생하면 서버에 저장된 최신 버전과 사용자의 로컬 버전의 데이터가 상이할 것이다. 이때 사용자에게 두 파일을 합치거나 새로운 사본을 생성하는 선택지를 제공할 수 있다.

> 파일이 매번 갱신될 때마다 전체 파일을 저장소 서버로 전송한다면 네트워크 대역폭을 많이 소모하게 된다. 이를 최적화 할 수 있는 방안을 제시하시오.
* 파일이 수정될 경우, 전체 파일이 아닌 수정된 파일 데이터만 네트워크로 전송한다. 이를 위해선 파일을 일정 크기의 블록 단위로 관리해야 한다.
* 또한 블록 단위로 나뉘어진 파일을 각각 압축해 전송되는 데이터의 양을 줄일 수 있다.
</details>


<br>

### 강한 일관성과 결과적 일관성 모델에 대해 설명하시오.

* 일관성 모델을 기반으로 RDBMS와 NoSQL의 차이점을 설명하시오.
* 특정 사용자가 파일을 수정할 경우, 다른 사용자들에게 이를 알림으로 전송해야 한다. 클라이언트와 알림 시스템 간 적절한 통신 방법은 무엇인가?

<details>
<summary><h4>해설</h4></summary>

> 분산 시스템에서의 강한 일관성과 결과적 일관성 모델에 대해 설명하시오.
* 강한 일관성 모델에서는 모든 분산된 컴포넌트들이 항상 동일한 데이터를 유지해아 한다.
* 반면에 결과적 일관성 모델에서는, 각 컴포넌트들이 일시적으로 불일치 상태에 있을 수 있지만 결과적으로는 일관성을 가져야 한다.

> 일관성 모델을 기반으로 RDBMS와 NoSQL의 차이점을 설명하시오.
* RDBMS는 안전한 트랜잭션 수행 환경을 제공하기 위해 ACID 속성을 만족한다. 즉 가용성보다 일관성을 우선시하기 때문에, 트랜잭션 수행 중 오류가 발생하면 전체 트랜잭션이 실패한다.
* 반면에 NoSQL은 일관성을 일부 포기하고 가용성을 보장하며, BASE 속성을 만족한다. RDBMS와 달리, 일시적으로 일관성이 깨지더라도 최종적으로는 일관성을 보장하는 결과적 일관성 모델을 채택하고 있다. 트랜잭션 수행 중 오류가 발생하면 전체 트랜잭션이 실패하지 않으며, 사용자는 일관적이지 않은 데이터에 일시적으로 접근할 수 있다.

> 특정 사용자가 파일을 수정할 경우, 다른 사용자들에게 이를 알림으로 전송해야 한다. 클라이언트와 알림 시스템 간 적절한 통신 방법은 무엇인가?
* 서버에서 클라이언트로 알림을 보내기 위한 방식으로는 롱 폴링과 웹 소켓 방식이 존재한다. 그러나 웹 소켓은 실시간 양방향 통신이 요구되는 상황에 적절하므로, 구글 드라이브에는 적절하지 않다. 왜냐하면 구글 드라이브에는 서버에서 클라이언트 방향의 통신만 필요하며, 알림을 보낼 일이 많지 않기 때문이다.
* 따라서 롱 폴링 방식을 채택할 수 있다. 롱 폴링을 적용할 경우, 클라이언트는 알림 서버에 지속적으로 연결을 생성하고, 이벤트를 통지받으면 연결을 끊는다. 이벤트 처리가 끝나거나 타임아웃이 발생하면 알림 서버에 롱 폴링 연결을 다시 생성해야 한다.
</details>
