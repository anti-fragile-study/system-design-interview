# Ch06. 키-값 저장소 설계 

> 분산 환경에서 데이터 일관성 수준을 결정하는 일관성 모델의 종류를 알려줄 수 있나요?

* 최종 일관성 모델을 선택한 경우, 쓰기 연산이 병렬적으로 발생하면 일관성이 깨질 수 있습니다. 이 때 클라이언트 측에서 일관성이 깨진 데이터를 읽지 않도록 하는 기법은 무엇이 있을까요?
* 그렇다면 벡터 시계가 어떻게 동작하는지 설명해주실 수 있나요?

<details>
<summary><h4>해설</h4></summary>

> 분산 환경에서 데이터 일관성 수준을 결정하는 일관성 모델의 종류를 알려줄 수 있나요?
* 모든 읽기 연산은 가장 최근에 갱신된 결과를 반환하여, 클라이언트는 옛날 데이터를 절대 보지 못하는 강한 일관성과 읽기 연산이 가장 최근에 갱신된 결과를 반환하지 못할 수 있는 약한 일관성, 그리고 약한 일관성의 한 형태로, 갱신 결과가 결국에는 모든 사본에 반영되는 최종 일관성 모델이 있다.

> 최종 일관성 모델을 선택한 경우, 쓰기 연산이 병렬적으로 발생하면 일관성이 깨질 수 있습니다. 이 때 클라이언트 측에서 일관성이 깨진 데이터를 읽지 않도록 하는 방법은 무엇이 있을까요?
* 벡터 시계를 활용해서 문제를 해결할 수 있다.

> 그렇다면 벡터 시계가 어떻게 동작하는지 설명해주실 수 있나요?
* 벡터 시계는 독립적인 서버와 버전의 순서 쌍을 데이터에 연결한 것이다. 동작 방식은 읽기, 쓰기 작업이 발생하는 경우 해당 서버와 순서 쌍을 1증가 시킨다. 
* 두 벡터가 충돌이 발생해서 병합해야 하는 경우 각 요소 별로 큰 값을 선택하여 적용한다.

</details>
<br>

> 분산 환경에서 장애 감지를 위해서 가십 프로토콜이 적용되어 있습니다. 이 때, 가십 프로토콜이 어떻게 동작하는지 설명해주세요.

* 데이터 일관성을 위해서 느슨한 정족수 접근법을 적용한 경우, 가십 프로토콜을 통해 장애를 감지하면 서버들에게 어떤 일이 발생하는지 알려주세요. 
* 영구적으로 장애가 발생한 것을 알게 된 경우 이를 처리하기 위해 반-엔트로피 프로토콜을 구현해서 사본들을 동기화할 수 있습니다. 이 경우 머클트리를 활용해 이 프로토콜을 구현할 수 있는데, 머클트리가 무엇인지 설명해주세요.

<details>
<summary><h4>해설</h4></summary>

> 분산 환경에서 장애 감지를 위해서 가십 프로토콜이 적용되어 있습니다. 이 때, 가십 프로토콜이 어떻게 동작하는지 설명해주세요.
* 각 노드는 멤버십 목록을 유지한다. 멤버십 목록은 각 멤버 ID와 박동 카운터 쌍의 목록이다. 각 노드는 주기적으로 자신의 박동 카운터를 증가시킨다. 
* 무작위로 선정된 노드들에게 주기적으로 자기 박동 카운터 목록을 보내는데, 어떤 멤버의 박동 카운터 값이 지정된 시간동안 갱신되지 않으면 장애 상태로 간주한다.

> 데이터 일관성을 위해서 느슨한 정족수 접근법을 적용한 경우, 가십 프로토콜을 통해 장애를 감지하면 서버들에게 어떤 일이 발생하는지 알려주세요. 
* 장애 상태인 서버로 가는 요청은 다른 서버가 잠시 맡아서 처리한다. 그 동안 발생한 변경사항은 해당 서버가 복구 되었을 때 일괄 반영하여 일관성을 보존한다.

> 영구적으로 장애가 발생한 것을 알게 된 경우 이를 처리하기 위해 반-엔트로피 프로토콜을 구현해서 사본들을 동기화할 수 있습니다. 
> 이 경우 머클트리를 활용해 이 프로토콜을 구현할 수 있는데, 머클트리가 무엇인지 설명해주세요.
* 머클트리는 자식 노드의 데이터를 해시로 계산한 값을 트리로 만든 데이터로 블록 단위로 빠르게 데이터를 검증하고 이상 유무를 확인할 수 있는 장점을 가지는 자료 구조이다.

</details>
