# Ch15. 구글 드라이브 설계

> 드라이브에서 두 명 이상의 사용자가 같은 파일이나 폴더를 동시에 업데이트하려고 하는 경우 문제가 발생할 수 있습니다. 이러한 문제를 어떻게 해결할 수 있을까요?

* 이렇게 충돌이 발생한 경우, 사용자가 충돌을 감지할 수 있게 알려주기 위한 알림 서비스를 만드려고 합니다. 이 경우, 롱 폴링을 적용할지, 웹 소켓을 적용하여 알림 서비스를 구현할 지 선택해주시고, 선택한 이유에 대해서 알려주세요.
* 롱 폴링의 동작 방식에 대해서 설명해주세요.

<details>
<summary><h4>해설</h4></summary>

> 드라이브에서 두 명 이상의 사용자가 같은 파일이나 폴더를 동시에 업데이트하려고 하는 경우 문제가 발생할 수 있습니다. 이러한 문제를 어떻게 해결할 수 있을까요?
* 먼저 처리되는 변경은 성공한 것으로 보고, 나중에 처리되는 변경은 충돌이 발생한 것으로 표시한다. 
* 충돌이 발생한 것으로 표시되면 충돌한 시점에서 같은 파일이 두 가지 버전으로 존재하게 되는데, 이 상태에서 사용자가 두 파일을 하나로 합칠지 아니면 둘 중 하나를 다른 파일로 대체할지를 결정한다.

> 이렇게 충돌이 발생한 경우, 사용자가 충돌을 감지할 수 있게 알려주기 위한 알림 서비스를 만드려고 합니다. 이 경우, 롱 폴링을 적용할지, 웹 소켓을 적용하여 알림 서비스를 구현할 지 선택해주시고, 선택한 이유에 대해서 알려주세요.
* 둘 다 좋은 방법이다. 여기서는 양방향 통신이 필요하지 않으므로 롱 폴링이 더 적합할 수 있다.

> 롱 폴링의 동작 방식에 대해서 설명해주세요.
* 롱 폴링은 먼저 클라이언트가 서버에 요청을 보냄으로서 이뤄진다. 서버는 이에 대한 응답을 즉시 보내지않고 연결을 계속 이루고 있게 된다. 
* 이후 이벤트가 발생하면 서버가 클라이언트에게 응답을 주게 된다. 응답을 받은 클라이언트는 다시 서버에게 요청을 보낼 수 있다.

</details>
<br>

> 우리 드라이브 시스템의 파일 블록 저장소로 AWS S3를 사용하기로 결정했습니다. AWS S3에 대해 아시는 것이 있다면 말해주세요.

* 전체 파일을 매번 계속 갱신하면 네트워크 대역폭을 많이 잡아먹게 됩니다. 이를 최적화하는 방법으로 어떤 것들이 있을까요?
* AWS S3를 사용하는데, 저희가 생각하는 것보다 저장용량을 많이 사용하게 되는 경우 어떻게 저장소 공간을 절약해볼 수 있을까요?

<details>
<summary><h4>해설</h4></summary>

> 우리 드라이브 시스템의 파일 블록 저장소로 AWS S3를 사용하기로 결정했습니다. AWS S3에 대해 아시는 것이 있다면 말해주세요.
* 업계 최고 수준의 확장성, 데이터 가용성, 보안 및 성능을 제공하는 객체 스토리지 서비스이다.
* 이미지, 동영상, 워드와 같은 파일을 저장할 수 있다.
* 버킷이라는 단위로 구분한다.

> 전체 파일을 매번 블록 저장소에 갱신하면 네트워크 대역폭을 많이 잡아먹게 됩니다. 이를 최적화하는 방법으로 어떤 것들이 있을까요?
* 파일이 수정되면 정체 파일 대신 수정이 일어난 블록만 동기화하는 델타 동기화 방법을 고려하거나, 압축 알고리즘을 활용해서 데이트의 크기를 줄이는 것을 생각해볼 수 있다.

> AWS S3를 사용하는데, 저희가 생각하는 것보다 저장용량을 많이 사용하게 되는 경우 어떻게 저장소 공간을 절약해볼 수 있을까요?
* 오랫동안 사용되지 않았던 데이터는 아카이빙 저장소를 만들어서, 따로 저장한다. 아카이빙 저장소는 S3보다 훨씬 저렴하다.
* 파일 블록의 해시값을 비교하여 중복된 파일 블록을 계정 차원에서 제거한다.

</details>
