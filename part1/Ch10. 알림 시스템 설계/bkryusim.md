# Ch10. 알림 시스템 설계

### 알림 서비스 설계 시, 이벤트 큐를 사용하면 어떤 장점이 있을까요?

* 트랜잭션을 활용해 이벤트 유실을 막는 아이디어를 제시해 주세요.
* 알림 이벤트 중복은 어떻게 방지할 수 있을까요?

<details>
<summary><h4>해설</h4></summary>

> 알림 서비스 설계 시, 이벤트 큐를 사용하면 어떤 장점이 있을까요?
* 이벤트 기반 아키텍처를 통해 결합도를 떨어뜨려 도메인 로직을 다루는 서버가 도메인에 집중할 수 있도록 돕습니다.
* 큐의 subscriber 수를 조절하여 알림 처리량을 유연하게 조절할 수 있습니다.

> 트랜잭션을 활용해 이벤트 유실을 막는 아이디어를 제시해 주세요.
* 이벤트 저장소를 활용해, 이벤트를 먼저 이벤트 스토어에 저장한 뒤, 이벤트를 발행합니다.
* 만일 도메인 로직이 실패하는 경우 이벤트 스토어에 이벤트가 저장되지 않고, 이벤트도 발행되지 않습니다.
* 이벤트 발행이 완료되면 해당 이벤트 레코드의 발행 정보를 업데이트합니다.(ex. published = true)
* 이후 배치 작업자가 이벤트 스토어를 탐색하며 정상 발행되지 않은 이벤트를 재발행합니다.
* [참고](https://techblog.woowahan.com/7835/)

> 알림 이벤트 중복은 어떻게 방지할 수 있을까요?
* 이벤트에 멱등키 항목을 추가하고, redis 등 응답이 빠른 저장소에 해당 멱등키로 이벤트가 발행되었다는 정보를 저장합니다.
* 멱등키가 충돌할 수도 있으므로 적절한 Timeout을 설정해 일정 시간 이후 발생한 같은 멱등키의 이벤트는 다른 이벤트로 간주합니다.
* 또는 멱등키 대신  이벤트의 해시를 연산하고, 해시를 저장하여 검증할 수도 있습니다.

</details>


<br>

### 알림을 전송하기 위해 준비해야 할 데이터는 어떤 것들이 있을까요?

* 알림을 받을 사용자의 디바이스 키, 이메일 등의 정보는 어디에 저장하는 것이 좋을까요? (알림 서버 DB, 회원 서버 DB에 저장 후 API 요청 시 payload에 담기)

<details>
<summary><h4>해설</h4></summary>

> 알림을 전송하기 위해 준비해야 할 데이터는 어떤 것들이 있을까요?
* 알림 플랫폼, 고유 식별자(단말 키, 이메일 등), 알림 내용 등을 준비해야 합니다.

> 알림을 받을 사용자의 디바이스 키, 이메일 등의 정보는 어디에 저장하는 것이 좋을까요? (알림 서버 DB, 회원 서버 DB에 저장 후 API 요청 시 payload에 담기)
* 디바이스 키 등 알림을 받기 위한 졍보는 알림 서버 DB에 저장하는 것이 좋습니다. 알림을 보낼 때만 필요한 데이터이기 때문에, 응집도를 높일 수 있고, API body의 크기가 줄어들어 대역폭을 아낄 수 있다는 장점이 있습니다.
</details>
