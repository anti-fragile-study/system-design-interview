# Ch05. 안정 해시 설계

### N개의 캐시 서버에 부하를 균등하게 나눌 수 있는 방법에는 무엇이 있는가?

* 모듈러 해시 함수를 사용할 경우 발생할 수 있는 문제에는 무엇이 있는가?
* 대부분의 키가 재분배되는 문제를 해결할 수 있는 방안에는 무엇이 있는가?

<details>
<summary><h4>해설</h4></summary>

> N개의 서버에 부하를 균등하게 나눌 수 있는 방법에는 무엇이 있는가?
* 모듈러 해시 함수를 사용해 특정 키 값이 저장될 서버 인덱스를 계산한다

> 모듈러 해시 함수를 사용할 경우 발생할 수 있는 문제에는 무엇이 있는가?
* 서버 풀의 수가 증가하거나 감소할 경우 나머지 연산의 값이 달라진다. 대부분의 키 분포가 달라지므로 대규모 캐시 미스가 발생한다

> 대부분의 키가 재분배되는 문제를 해결할 수 있는 방안에는 무엇이 있는가?
* 안정 해시 알고리즘을 사용한다
* 전통적인 해시 함수는 서버 수가 변할 때 대부분의 키가 재배치되는 반면에, 안정 해시는 테이블 크기가 조정될 때 평균적으로 k/n 개의 키만 재배치된다 
</details>


<br>

### 안정 해시 알고리즘은 어떻게 동작하는가?

* 안정 해시 알고리즘에서 발생할 수 있는 문제점에는 무엇이 있는가?
* 키 값이 균등 분포되지 않는 문제를 해결할 수 있는 방안에는 무엇이 있는가?

<details>
<summary><h4>해설</h4></summary>

> 안정 해시는 어떻게 동작하는가?
* 서버의 IP나 이름을 해싱하여 해시 공간에 서버를 위치시킨다
* 키를 저장할 때는 키의 해시 값으로부터 시계 방향으로 해시 공간을 탐색하고, 가장 첫 번째로 만나는 서버에 값을 저장한다

> 안정 해시 알고리즘에서 발생할 수 있는 문제점에는 무엇이 있는가?
* 첫 번째로는, 인접한 서버 사이의 해시 공간인 파티션을 균등하게 유지하는 게 불가능하다
* 어떤 서버는 굉장히 작은 해시 공간을 할당 받고, 어떤 서버는 굉장히 큰 해시 공간을 할당 받는 상황이 발생할 수 있다
* 두 번째로는, 키 값의 균등 분포를 달성하기 어렵기 때문에 특정 서버에 모든 키 값이 몰릴 수 있다

> 키 값이 균등 분포되지 않는 문제를 해결할 수 있는 방안에는 무엇이 있는가?
* 서버의 가상 노드를 여러 개 생성해 링 위에 배치한다
* 키 값은 해시 공간을 시계 방향으로 순회하다가 가장 처음 만나는 가상 노드가 가리키는 서버에 저장된다
* 가상 노드의 수가 많을수록 키 값이 고르게 분포된다고 한다
</details>
