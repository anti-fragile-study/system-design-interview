# Ch12. 채팅 시스템 설계

> 폴링, 롱폴링에 대해서 설명해주세요.

* 롱폴링 기법을 사용해서 채팅 시스템을 설계한다고 가정했을 때, 발생할 수 있는 문제점은 무엇인가요?
* 웹소켓 기술은 어떻게 동작하고, 이를 활용해서 채팅 시스템을 설계했을때 장단점을 설명해주세요.

<details>
<summary><h4>해설</h4></summary>

> 폴링, 롱폴링에 대해서 설명해주세요.
* 폴링은 클라이언트가 주기적으로 서버에게 새 메시지가 있냐고 물어보는 방법이다. 
* 롱폴링은 클라이언트는 새 메시지가 반환되거나 타임아웃 될 때까지 연결을 유지하고, 클라이언트는 새 메시지를 받으면 기존 연결을 종료하고 서버에 새로운 요청을 보내어 모든 절차를 다시 시작하는 방식으로 동작한다.

> 롱폴링 기법을 사용해서 채팅 시스템을 설계한다고 가정했을 때, 발생할 수 있는 문제점은 무엇인가요?
* 메시지를 보내는 클라이언트와 수신하는 클라이언트가 같은 채팅 서버에 접속하게 되지 않을 수도 있다. 로드밸런싱을 위해 라운드 로빈 알고리즘을 사용하는 경우, 메시지를 받은 서버는 해당 메시지를 수신할 클라이언트와 연결을 가지고 있지 않은 서버일 수 있다.
* 서버 입장에서는 클라이언트가 연결을 해제했는지 아닌지 알 좋은 방법이 없다.

> 웹소켓 기술은 어떻게 동작하고, 이를 활용해서 채팅 시스템을 설계했을때 장단점을 설명해주세요.
* HTTP 연결로 특정 핸드셰이크 절차를 거쳐 웹소켓 연결로 업그레이드 되는데, 일단 이 연결이 만들어지고 나면 서버는 클라이언트에게 비동기적으로 메시지를 전송할 수 있다.
* 장점으로는 웹소켓을 이용하면 메시지를 보낼때나 받을 때 동일한 프로토콜을 사용할 수 있으므로 설계뿐 아니라 구현도 단순하고 직관적이다. 유의할 점은 쉡소켓 연결은 항구적으로 유지되어야 하므로 서버 측에서 연결 관리를 효율적으로 해야 한다.

</details>
<br>

> SPOF를 방지하기 위해서 채팅서버를 여러 대 두려고 헙니다. 이 경우, 어떤 방법을 통해 클라이언트가 적합한 채팅서버를 찾을 수 있도록 할 수 있을까여?

* 서비스 탐색 서비스에서 적합한 채팅 서버를 추천하는 기준은 어떤 것들이 있을까요?
* 서비스 탐색 기능을 구현하는데 사용되는 오픈 소스 솔류션인 아파치 주키퍼에 대해 아시는 것이 있다면 이에 대해 설명해주세요.

<details>
<summary><h4>해설</h4></summary>

> SPOF를 방지하기 위해서 채팅서버를 여러 대 두려고 헙니다. 이 경우, 어떤 방법을 통해 클라이언트가 적합한 채팅서버를 찾을 수 있도록 할 수 있을까요?
* 아파치 주키퍼와 같은 서비스 탐색 서비스를 두고, 모든 채팅 서버를 여기 등록시켜두고, 클라이언트가 접속을 시도하면 사전에 정한 기준에 따라 최적의 채팅서버를 골라줄 수 있다.

> 서비스 탐색 서비스에서 적합한 채팅 서버를 추천하는 기준은 어떤 것들이 있을까요?
* 클라이언트의 위치나, 서버의 용량 등등을 기준으로 사용할 수 있다.

> 서비스 탐색 기능을 구현하는데 사용되는 오픈 소스 솔류션인 아파치 주키퍼에 대해 아시는 것이 있다면 이에 대해 설명해주세요.
* 야후에서 개발되어서, 아파치 라이센스로 오픈소스화 된 프로젝트이다. 
* 특징과 장점으로는 단순해서 사용자는 추상화된 몇 가지 기능을 통해서 분산처리를 위한 주키퍼 파일 시스템을 이용할 수 있고, 고가용성을 제공해주며, 느슨하게 연결되는 상호작용을 할 수 있도록 도와줘서 참여자들끼리 서로 몰라도 된다는 장점이 있다.
* 주키퍼는 기본적으로 다수의 노드를 가진 클러스터구조에서 복제 모드로 수행되어야 한다. 이러한 클러스터 구조를 앙상블이라고 부른다.

</details>
