# Ch06. 키-값 저장소 설계
### 머클 트리를 통해 다른 데이터를 가진 노드를 탐색하는 방식을 설명해 주세요.

* 가십 프로토콜을 통해 장애 노드를 탐지하는 방법을 설명해 주세요.

<details>
<summary><h4>해설</h4></summary>

> 머클 트리를 통해 다른 데이터를 가진 노드를 탐색하는 방식을 설명해 주세요.
* 먼저 키-값 공간을 여러개의 버킷으로 나눕니다. 버킷 내 모든 키를 해시로 변환한 후, 버킷별로 해시값을 계산하여 해당 해시 값을 레이블로 갖는 노드를 만듭니다. 그리고 자식 노드의 레이블로부터 다시 해시값을 계산하며 이진 트리를 구성합니다. 이후 root값부터 비교하며 만일 root값이 같다면 두 서버의 데이터가 동기화된 것이고, 다르다면 동기화가 필요하다는 의미를 갖습니다.

> 가십 프로토콜을 통해 장애 노드를 탐지하는 방법을 설명해 주세요.
* 각 노드는 주기적으로 자신의 박동 카운터를 무작위 노드로 전송합니다. 박동 카운터를 받은 노드는 전송한 노드의 박동 카운터를 멤버십 목록으로 관리하고, 항상 최신화합니다. 그리고 일정 시간 이상 박동 카운트가 증가하지 않는 노드가 발견되면, 발견한 노드가 다른 노드들에게 자신의 멤버십 목록을 전송해 다른 노드들이 어떤 노드에 장애가 발생했는지 알 수 있도록 합니다.

</details>


<br>

### 벡터 시계의 동작 원리와 충돌 감지 방식을 설명해 주세요.

* 벡터 시계 방식의 단점에 대해 이야기해 주세요

<details>
<summary><h4>해설</h4></summary>

> 벡터 시계의 동작 원리와 충돌 감지 방식을 설명해 주세요.
* 벡터 시계는 작업을 수행한 서버와 데이터의 버전의 쌍을 리스트로 저장하는 자료구조입니다. 쓰기, 갱신 작업이 일어날 때 마다 데이터쌍을 추가/갱신합니다. 버전 X가 버전 Y보다 이전 버전인지 확인하려면, 모든 구성요소가 다른 버전의 모든 구성요소보다 작은지 확인하면 됩니다. 그렇지 않다면 충돌이 일어난 것으로 판단합니다.

> 벡터 시계 방식의 단점에 대해 이야기해 주세요
* 충돌을 감지하고 해소하는 로직이 클라이언트에 들어가 클라이언트 구현이 복잡해 집니다.
* 순서쌍 개수가 너무 많이 늘어나 저장 공간을 많이 차지할 수 있습니다. 이를 위해 특정 임계치가 넘으면 오래된 순서쌍을 제거하도록 설정할 수 있습니다.
</details>
