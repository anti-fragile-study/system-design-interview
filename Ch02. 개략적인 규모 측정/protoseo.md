# Ch02. 개략적인 규모 측정

> 아래의 조건을 만족하는 메신저 프로그램이 있다고 가정할 때, 다음 문제를 해결해주세요. (어떻게 문제를 해결하는지 과정을 보여주세요.)

```text
- 월간 능동 사용자는 40,000,000 명이다.
- 매일 75%의 사용자가 매일 메신저 프로그램을 사용한다.
- 평균적으로 각 사용자는 매일 50개의 메시지를 보낸다.
- 사진, 영상을 포함하는 메시지는 25% 정도이다.
- 데이터는 10년간 보관된다.
```

* 해당 메신저 프로그램의 QPS 추정치를 계산해주세요. 
* 메시지 데이터 저장을 위한 저장소 요구량 추정치를 계산해주세요.

<details>
<summary><h4>해설</h4></summary>

> 해당 메신저 프로그램의 QPS 추정치를 계산해주세요. 
* DAU = 40,000,000 * 75 / 100 = 30,000,000명
* QPS = 30,000,000 * 50 / (24 * 60 * 60) = 약 17500
* Peek QPS = 17500 * 2 = 35000

> 메시지 데이터 저장을 위한 저장소 요구량 추정치를 계산해주세요. 

```text
message_id = 64byte
sender_id = 64byte
receiver_id = 64byte
message = 200byte
media(image, video) = 10MB
```
* DAU = 40,000,000 * 75 / 100 = 30,000,000명 
* 하루의 텍스트 메세지 용량 = 30,000,000 * 50 * 200byte * 75 / 100 = 225 GB
* 하루의 미디어 메세지 용량 = 30,000,000 * 50 * 10MB * 25 / 100 = 3.75 PB
* 10년간 메세지 데이터를 보관하기 위한 저장소 요구량 추정치 = (3.75 PB) * 365 * 10 = 13.6875 EB(엑사 바이트)

</details>

> 프로젝트를 EC2 하나에 배포했는데, 이 프로젝트가 너무 흥해서 사용자가 많아지게 되었고, 이로 인해 EC2에 과부하가 발생했습니다. 이를 어떻게 해결할 수 있을까요?

* 더 좋은 성능의 EC2를 사용하는 경우, 장점과 단점에 대해서 설명해주세요.
* 동일한 성능의 EC2 개수를 늘리는 경우, 장점과 단점에 대해서 설명해주세요.

<details>
<summary><h4>해설</h4></summary>

> 프로젝트를 EC2 하나에 배포했는데, 이 프로젝트가 너무 흥해서 사용자가 많아지게 되었고, 이로 인해 EC2에 과부하가 발생했습니다. 이를 어떻게 해결할 수 있을까요?
* 더 좋은 성능의 EC2를 사용하거나, 여러 대의 EC2를 두고 ELB를 앞에 둬서 부하를 분산하게 할 수 있다.

> 더 좋은 성능의 EC2를 사용하는 경우, 장점과 단점에 대해서 설명해주세요.
* 여러 대의 EC2를 관리해야 하는 부담이 적어지고, 또한 성능이 좋은 EC2로 바꾸면 되므로 부담이 적다. 하지만 성능 증가에 따라서 비용이 많이 지불될 수 있는 단점이 존재한다. 한 대의 서버에 부하가 집중되는 것은 변함이 없으므로 장애의 영향이 클 수 밖에 없다. 또한 성능을 올리는 방법은 결국 제약이 있을 수밖에 없다.

> 동일한 성능의 EC2 개수를 늘리는 경우, 장점과 단점에 대해서 설명해주세요.
* 확장을 할 때 유연해진다. 더 많은 트래픽이 늘어나는 경우, 기존에 추가적인 EC2를 더 추가하면 된다. 또한 비교적 저렴한 비용의 EC2가 증가하는 것이므로 비용의 부담이 적다. 하지만 여러 대의 EC2를 연결해서 구축해야 하므로 로드 밸런싱에 대한 이해와 추가적인 병렬적인 컴퓨팅 환경에 대한 높은 이해도가 필요해진다.
</details>

> 메모리 계층에 대해서 설명해주세요.

* 캐시 메모리의 지역성의 종류와 각 특징에 대해서 설명해주세요.
* 메모리는 빠르고 디스크는 느린데, 그 이유에 대해서 설명해주세요.

<details>
<summary><h4>해설</h4></summary>

> 메모리 계층에 대해서 설명해주세요.
* 위에서부터 레지스터, 캐시 메모리(L1, L2, L3), 메모리, 하드 디스크로 구성되어 있다.

> 캐시 메모리의 지역성의 종류와 각 특징에 대해서 설명해주세요.
* 시간 지역성과 공간 지역성이 있다. 시간 지역성은 최근에 참조된 주소의 내용은 곧 다음에 참조되는 특성이고, 공간 지역성은 대부분의 프로그램이 참조된 주소와 인접한 주소의 내용이 다시 참조된다는 특성이다.

> 메모리는 빠르고 디스크는 느린데, 그 이유에 대해서 설명해주세요.
* 메모리는 구조적으로 전원이 들어오는 경우에만 저장이 되는 휘발성 저장소로 메모리 주소를 활용해서 빠르게 접근이 가능하다. 하지만 디스크의 경우 비휘발성 저장소로 구조적으로 데이터를 저장하는 원판과 이 원판을 읽는 역할을 하는 헤더로 구성된다. 즉, 데이터를 찾기 위해서는 데이터가 저장된 위치까지 원판을 돌리고, 헤더를 움직여서 찾아야 하기 때문에 느리게 접근된다.

</details>
