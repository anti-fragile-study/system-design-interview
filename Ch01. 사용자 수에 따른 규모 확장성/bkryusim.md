# Ch01. 사용자 수에 따른 규모 확장성


### 질문

> 쇼핑몰 개발 프로젝트에서 MySQL을 단일 DB 서버로 사용한 경험이 있다고 하셨는데, 같은 상황에서 특정 인기 상품들만의 조회 요청 수가 크게 증가한다고 가정합니다. 조회 처리량을 증가시키기 위한 효과적인 시스템 설계 방안을 제시해 주세요.

* 주문은 단일 테이블에 저장하고 있었는데, 주문이 많이 들어와서 주문 테이블이 단기간에 엄청나게 커졌습니다. 어떤 문제가 발생할 수 있을까요? 어떻게 해결할 수 있을까요?
* 상품의 정보가 카테고리별로 다른 항목들로 이루어질 수 있다는 요구사항이 추가되었습니다. 예를 들어 식품의 경우 유통기한, 보관방식, 용량(g), 알레르기 성분 등의 정보를 저장해야 하고, 노트북의 경우 CPU 사양, RAM 용량 등의 정보를 저장해야 합니다. 어떻게 효율적인 DB를 구성할 수 있을까요?


<details>
<summary><h4>해설</h4></summary>

> 쇼핑몰 개발 프로젝트에서 MySQL을 단일 DB 서버로 사용한 경험이 있다고 하셨는데, 같은 상황에서 특정 인기 상품들만의 조회 요청 수가 크게 증가한다고 가정합니다. 조회 처리량을 증가시키기 위한 효과적인 시스템 설계 방안을 제시해 주세요.
* 캐시를 사용하여 해결할 수 있습니다. 같은 상품에 대한 조회가 발생하기 떄문에 캐시가 효과적으로 동작할 수 있는 환경입니다.

> 주문은 단일 테이블에 저장하고 있었는데, 주문이 많이 들어와서 주문 테이블이 단기간에 엄청나게 커졌습니다. 어떤 문제가 발생할 수 있을까요? 어떻게 해결할 수 있을까요?
* 인덱스의 크기가 커져서 인덱스 사용 탐색 시 인덱스를 메모리에 불러오는 속도 때문에 조회 성능에 안좋은 영향이 미칠 것 같습니다. Partition을 통해 데이터베이스를 수평 분할하거나, 샤딩을 활용해 해결할 수 있을 것 같습니다.

> 상품의 정보가 카테고리별로 다른 항목들로 이루어질 수 있다는 요구사항이 추가되었습니다. 예를 들어 식품의 경우 유통기한, 보관방식, 용량(g), 알레르기 성분 등의 정보를 저장해야 하고, 노트북의 경우 CPU 사양, RAM 용량 등의 정보를 저장해야 합니다. 어떻게 효율적인 DB를 구성할 수 있을까요?
* 비정형 데이터를 저장하는 경우 NoSQL을 사용하는 것이 효과적입니다.
</details>
<br>

### 질문
> 10분 ~ 30분 정도의 긴 영상을 업로드하면, `AI를 이용해 자동으로 2~3개의 숏츠 영상을 생성해주는 서비스`를 개발하려고 합니다. AI 모델은 준비되어 있고, 모델 함수의 input으로 `원본 영상 파일 스트림`과 `결과물을 받을 output 디렉터리` 두 가지를 제공하면 output 경로에 3개의 숏츠를 압축한 압축 파일이 제공됩니다. 이 서비스를 설계할 때 고려할 만한 사항이나, 사용자가 많아지면 발생할 예상되는 문제점을 자유롭게 말해 주세요.

* 사용자에게 작업 프로세스(업로드 - 모델로 영상 생성 - 영상을 스토리지에 업로드 - 완료)를 실시간으로 보여주려고 합니다. 창을 닫아도 작업은 지속되며, 창을 껐다가 다시 켜도 진행 사항을 마이페이지에서 다시 접근할 수 있도록 하고 싶습니다. 어떻게 설계하면 좋을까요?
* 모델 서버를 분리하는 경우, 작업 요청을 보내는 방식과, 파일을 전달하는 방식을 결정하고 이유를 설명해 주세요.

<details>
<summary><h4>해설</h4></summary>

> 10분 ~ 30분 정도의 긴 영상을 업로드하면, `AI를 이용해 자동으로 2~3개의 숏츠 영상을 생성해주는 서비스`를 개발하려고 합니다. AI 모델은 준비되어 있고, 모델 함수의 input으로 `원본 영상 파일 스트림`과 `결과물을 받을 output 디렉터리` 두 가지를 제공하면 output 경로에 3개의 숏츠를 압축한 압축 파일이 제공됩니다. 이 서비스를 설계할 때 고려할 만한 사항이나, 사용자가 많아지면 발생할 예상되는 문제점을 자유롭게 말해 주세요.
* 모델이 영상을 프로세싱하는 데 긴 시간이 필요하다는 것을 주의해야 합니다. 사용자가 많아지는 경우 모델 서버의 처리량이 요청을 따라가지 못한다면, 모델 서버를 수평 확장하기 위해 모델 서버를 stateless하게 설계해야 합니다. 따라서 영상 파일을 바로 모델 서버에 올리지 말고, 다른 별도의 스토리지에 업로드하고 모델 서버에서 다운받아 사용하도록 해야 할 것 같습니다.

> 사용자에게 작업 프로세스(업로드 - 모델로 영상 생성 - 영상을 스토리지에 업로드 - 완료)를 실시간으로 보여주려고 합니다. 창을 닫아도 작업은 지속되며, 창을 껐다가 다시 켜도 진행 사항을 마이페이지에서 다시 접근할 수 있도록 하고 싶습니다. 어떻게 설계하면 좋을까요?
* 이벤트 큐를 활용하여 각 작업의 완료 시점에 이벤트를 발생시키고, 하나의 consumer가 모든 이벤트를 수집해 진행 상황을 저장하고 websocket 혹은 sse를 이용해 클라이언트에게 전송하여 구현할 수 있습니다.

> 모델 서버를 분리하는 경우, 작업 요청을 보내는 방식과, 파일을 전달하는 방식을 결정하고 이유를 설명해 주세요.
* 영상 파일을 별도 스토리지 서버에 업로드한 뒤, 업로드 작업이 완료되면 이벤트 큐를 활용해 모델 서버에 작업 완료 이벤트를 전달하고, 해당 이벤트를 subscribe하여 파일을 다시 다운로드받는 방식으로 동작시킬 수 있습니다.
</details>
<br>

### 질문

> 샤딩과 레플리케이션, 클러스터링의 차이를 설명해 주세요.

- DB서버와 애플리케이션 서버를 다중으로 사용하고자 할 때, 지역적으로 분리된 다수의 데이터 센터에 각각 하나씩의 DB서버를 위치시키려 합니다. 레플리케이션 방식으로 복제하는 경우, 클러스터링 방식으로 복제하려는 경우 중 어떤 방식을 사용할지 이유와 함께 골라 주세요.
- 샤딩을 사용할 때 주의점을 설명해 주세요.

<details>
<summary><h4>해설</h4></summary>

> 샤딩과 레플리케이션, 클러스터링의 차이를 설명해 주세요.
* 레플리케이션과 클러스터링은 다중 DB를 사용할 때 모든 데이터베이스가 같은 값을 동기화합니다. 레플리케이션은 Master-Slave 구조로 작동하여 하나의 노드에만 쓰기 작업을 사용할 수 있고, 나머지 노드들은 읽기 작업만 수행합니다. 클러스터링을 사용하면 모든 노드에 쓰기 및 읽기 작업을 사용할 수 있습니다.
* 샤딩은 모든 노드들이 다른 값을 저장하며, 샤딩 키에 따라 데이터를 적절한 노드에 분산하여 저장하는 방식입니다.

>  DB서버와 애플리케이션 서버를 다중으로 사용하고자 할 때, 지역적으로 분리된 다수의 데이터 센터에 각각 하나씩의 DB서버를 위치시키려 합니다. 레플리케이션 방식으로 복제하는 경우, 클러스터링 방식으로 복제하려는 경우 중 어떤 방식을 사용할지 이유와 함께 골라 주세요.
* 클러스터링을 선택할 것 같습니다. 각 지역마다 애플리케이션 서버를 두어 수평 확장을 하는 경우, 레플리케이션을 사용하면 write 작업을 하는 DB가 한 지역에만 위치할 수 있기 때문에, 다른 지역에서 쓰기 요청을 하는 경우 DB까지 네트워크 지연시간이 커져 전체적인 레이턴시가 길어질 수 있습니다. 클러스터링을 사용하여 모든 지역의 db에 쓰기 작업을 할 수 있도록 설정하는 것이 지연시간 측면에서 좋다고 생각합니다.

> 샤딩을 사용할 때 주의점을 설명해 주세요.
* Join 동작이 불가능하기 때문에 id로 참조하는 방법을 강구해야 합니다. 또 하나의 샤드 간 데이터 분포를 골고루 하기 위한 적절한 샤딩 정책을 설정해야 합니다.
</details>
<br>
