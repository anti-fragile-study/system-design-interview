# Ch07. 분산 시스템을 위한 유일 ID 생성기 설계

### 분산된 데이터베이스 서버를 사용할 경우 어떤 사항을 고려해야 하는가?

* 분산된 데이터베이스에서 유일한 ID는 어떤 방식으로 생성 가능한가? ID는 숫자로만 구성되며 시간 순으로 정렬 가능해야 한다
* 트위터 스노우플레이크 방식으로 64비트의 유일한 ID 값을 생성하였다. 이 중에서 5비트를 데이터센터 ID에 할당하고, 5비트를 서버 ID, 12비트를 일련번호에 할당하였다. 초당 최대 몇 개의 ID를 생성할 수 있는가?
  * <i>일련번호는 1밀리초가 경과할 때마다 0으로 초기화된다</i>
  * <i> 구체적인 숫자 대신 2의 지수승으로 표현 가능</i>

<details>
<summary><h4>해설</h4></summary>

> 분산된 데이터베이스 서버를 사용할 경우 어떤 사항을 고려해야 하는가?
* 데이터를 수평 분할할 경우, 하나의 데이터베이스의 데이터가 집중되지 않도록 분산해야 한다
* 데이터를 복제할 경우, 데이터 일관성을 유지해야 한다
* 분산된 데이터베이스에서 프라이머리 키로 사용할 수 있는 유일한 ID를 생성할 수 있어야 한다

> 분산된 데이터베이스에서 유일한 ID는 어떤 방식으로 생성 가능한가? ID는 숫자로만 구성되며 시간 순으로 정렬 가능해야 한다
* ID의 앞 부분을 타임스탬프로 고정한다. ID는 숫자로만 구성되어야 하므로 에포크 시간을 사용할 수 있다. 
  * <i>에포크 시간은 1970년 1월 1일 00:00:00 협정 세계시 부터의 경과 시간을 초로 환산하여 정수로 나타낸 것</i>
* 뒷 부분은 ID를 생성한 서버 ID와 내부적으로 관리하는 일련번호를 붙여 시간순으로 정렬 가능하면서 유일한 ID를 생성할 수 있다.

> 유일한 ID를 생성을 위해 중앙 집중형 티켓 서버를 사용할 경우 어떤 문제가 발생할 수 있는가

* 분산된 서버에서 타임스탬프 기반의 ID를 생성할 때, 각 서버에서 사용하는 시계가 동기화되지 않으면 문제가 발생할 수 있다. 이를 해결할 수 있는 방안에는 무엇이 있는가?
* 트위터 스노우 플레이크 방식에서는 69년동안만 ID 생성이 가능했다. 만약 동시에 생성 가능한 ID의 수를 줄이더라도, 수명이 더 긴 생성 체계를 만들고 싶다면 어떻게 할 수 있을까?

> 트위터 스노우플레이크 방식으로 64비트의 유일한 ID 값을 사용했다고 가정하자. 이 중에서 5비트를 데이터센터 ID에 할당하고, 5비트를 서버 ID, 12비트를 일련번호에 할당하였다. 초당 최대 몇 개의 ID를 생성할 수 있는가?
* 하나의 서버는 1밀리초에 2^12개의 ID를 생성할 수 있다. 또한 최대 2^5개의 데이터센터에 2^5개의 서버를 설치할 수 있다
* 따라서 2^12 * 2^5 * 2^5 개, 즉 초당 2^22 개의 유일한 ID 생성이 가능하다 
</details>


<br>

### 유일한 ID를 생성을 위해 중앙 집중형 티켓 서버를 사용할 경우 어떤 문제가 발생할 수 있는가

* 분산된 서버에서 타임스탬프 기반의 ID를 생성할 때, 각 서버에서 사용하는 시계가 동기화되지 않으면 문제가 발생할 수 있다. 이를 해결할 수 있는 방안에는 무엇이 있는가?
* 트위터 스노우 플레이크 방식에서는 69년동안만 ID 생성이 가능했다. 만약 동시에 생성 가능한 ID의 수를 줄이더라도, 수명이 더 긴 생성 체계를 만들고 싶다면 어떻게 할 수 있을까?

<details>
<summary><h4>해설</h4></summary>

> 유일한 ID를 생성을 위해 중앙 집중형 티켓 서버를 사용할 경우 어떤 문제가 발생할 수 있는가
* 중앙 집중형 티켓 서버를 사용할 경우, 티켓 서버는 `SPOF` (단일 장애점) 가 된다. 해당 서버에 장애가 생기면 모든 시스템이 중단된다

> 분산된 서버에서 타임스탬프 기반의 ID를 생성할 때, 각 서버에서 사용하는 시계가 동기화되지 않으면 문제가 발생할 수 있다. 이를 해결할 수 있는 방안에는 무엇이 있는가?
* 네트워크를 사용해 시간 서버로부터 시간 정보를 받아와 동기화할 수 있다
* 분산 서버는 일정 시간 간격마다 시간 서버에 요청을 보내 시계를 동기화한다

> 트위터 스노우 플레이크 방식에서는 69년동안만 ID 생성이 가능했다. 만약 동시에 생성 가능한 ID의 수를 줄이더라도, 수명이 더 긴 생성 체계를 만들고 싶다면 어떻게 할 수 있을까?
* 69개의 비트 중 일련번호에 할당되는 비트를 줄이고, 이를 타임스탬프에 할당할 수 있다
</details>
